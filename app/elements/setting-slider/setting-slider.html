<!--
  ~ Copyright 2017 Michael A Updike
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  -->
<link rel="import" href="../setting-base/setting-base.html">

<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">

<dom-module id="setting-slider">
	<template>
		<style include="iron-flex iron-flex-alignment"></style>
		<style include="shared-styles"></style>
		<style>
			:host {
				display: block;
			}

			:host([disabled]) {
				pointer-events: none;
			}

			:host([disabled]) .setting-label {
				color: var(--disabled-text-color);
			}

			#label {
				margin: 20px 0 0 0;

				--paper-item-min-height: {
					min-height: 0;
				};
			}

			:host paper-slider {
				position: relative;
				margin: 0;
				padding-right: 16px;
				padding-left: 5px;
				cursor: pointer;
			}

			:host paper-dropdown-menu {
				width: 175px;
				padding-right: 16px;

				--paper-input-container-input: {
					text-align: right;
				};
			}
		</style>

		<setting-base id="base"
					  name="[[name]]" value="{{value}}"
					  default-value='{"base": 10, "display": 10, "unit": 0}'
					  section-title="[[sectionTitle]]"
					  noseparator="[[noseparator]]" disabled="[[disabled]]">
			<paper-item id="label" class="setting-label" tabindex="-1">{{label}}</paper-item>
			<div class="horizontal layout">
				<paper-slider class="flex" editable value="{{value.display}}"
							  min="{{unit.min}}" max="{{unit.max}}" step="{{unit.step}}"
							  disabled$="[[disabled]]" on-change="_sliderValueChanged"></paper-slider>
				<paper-dropdown-menu disabled$="[[disabled]]" noink no-label-float>
					<paper-menu id="menu" class="dropdown-content" selected="{{value.unit}}" on-iron-select="_unitChanged">
						<template is="dom-repeat" as="unit" items="[[units]]">
							<paper-item>[[unit.name]]</paper-item>
						</template>
					</paper-menu>
				</paper-dropdown-menu>
				<array-selector id="selector" items="[[units]]" selected="{{unit}}"></array-selector>
			</div>
		</setting-base>
	</template>
</dom-module>

<script>
'use strict';
Polymer({
	is: 'setting-slider',

	properties: {
		label: {
			type: String,
			value: '',
		},

		units: {
			type: Array,
			value: function() {
				return [];
			},
		},

		sectionTitle: {
			type: String,
			value: '',
		},
	},

	/**
	 * set the base value
	 */
	_setBase: function() {
		const value = this.$.base.getValue();
		value.base = this.unit.mult * value.display;
		this.$.base.setValue(value);
	},

	/**
	 * Event: user changed slider value
	 */
	_sliderValueChanged: function() {
		this._setBase();
	},

	/**
	 * Event: display unit changed
	 */
	_unitChanged: function() {
		const value = this.$.base.getValue();
		this.$.selector.select(this.units[value.unit]);
		this._setBase();
	},
});
</script>
